<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI TRAIN TRACKER</title>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-database-compat.js"></script>
    <style>
        :root { --primary: #1e3c72; --bg: #f4f7f6; }
        body { font-family: 'Segoe UI', Arial, sans-serif; background: var(--bg); margin: 0; }
        .header { background: var(--primary); color: white; padding: 15px; text-align: center; font-weight: bold; }
        .container { padding: 15px; }
        .card { background: white; border-radius: 15px; padding: 20px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); margin-bottom: 20px; }
        .input-box { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #ccc; border-radius: 8px; box-sizing: border-box; }
        .btn { width: 100%; padding: 12px; background: var(--primary); color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; }
        .ai-status { background: #e3f2fd; border-left: 5px solid #1976d2; padding: 10px; margin-top: 10px; font-size: 14px; }
        #map-container { width: 100%; height: 300px; border-radius: 10px; margin-top: 15px; display: none; border: 2px solid #ddd; }
        .user-dot { color: green; font-weight: bold; font-size: 12px; }
    </style>
</head>
<body onload="initApp()">

<div class="header">BD-IN SMART APP | AI CONTROL</div>

<div class="container">
    <div class="card">
        <h3>üöÇ ‡¶ü‡ßç‡¶∞‡ßá‡¶® ‡¶≤‡¶æ‡¶á‡¶≠ ‡¶∏‡¶æ‡¶∞‡ßç‡¶ö (AI)</h3>
        <p style="font-size: 12px; color: #666;">Gemini & Grok AI ‡¶≤‡¶ú‡¶ø‡¶ï ‡¶¶‡ßç‡¶¨‡¶æ‡¶∞‡¶æ ‡¶ö‡¶æ‡¶≤‡¶ø‡¶§</p>
        <input type="text" id="train-input" class="input-box" placeholder="‡¶ü‡ßç‡¶∞‡ßá‡¶®‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶® (BD/IN)">
        <button class="btn" onclick="aiSearch()">‡¶≤‡¶æ‡¶á‡¶≠ ‡¶≤‡ßã‡¶ï‡ßá‡¶∂‡¶® ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶®</button>
        
        <div id="ai-response" class="ai-status" style="display: none;"></div>
        
        <iframe id="map-container"></iframe>
    </div>

    <div class="card" id="admin-panel">
        <h4>‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶°‡ßç‡¶Ø‡¶æ‡¶∂‡¶¨‡ßã‡¶∞‡ßç‡¶°</h4>
        <div id="user-list"></div>
    </div>
</div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyAITEO9cEv0D9DXAummlx1Ak6JTnn5Yus8",
        databaseURL: "https://bd--in-smart-app-default-rtdb.firebaseio.com/",
        projectId: "bd--in-smart-app",
        appId: "1:10255323809:android:b7182e5bfb340f710d96e0"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // ‡¶Ö‡¶ü‡ßã ‡¶≤‡ßã‡¶ï‡ßá‡¶∂‡¶® ‡¶ü‡ßç‡¶∞‡ßç‡¶Ø‡¶æ‡¶ï‡¶ø‡¶Ç (‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶ü‡ßç‡¶∞‡ßá‡¶®‡ßá‡¶∞ ‡¶≠‡ßá‡¶§‡¶∞ ‡¶•‡¶æ‡¶ï‡¶≤‡ßá ‡¶Ö‡¶ü‡ßã ‡¶ï‡¶æ‡¶ú ‡¶ï‡¶∞‡¶¨‡ßá)
    function initApp() {
        if (navigator.geolocation) {
            navigator.geolocation.watchPosition(pos => {
                // ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶´‡ßã‡¶® ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ ‡¶è‡¶¨‡¶Ç ‡¶ü‡ßç‡¶∞‡ßá‡¶®‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ ‡¶≤‡ßã‡¶ï‡¶æ‡¶≤ ‡¶∏‡ßç‡¶ü‡ßã‡¶∞‡ßá‡¶ú ‡¶•‡ßá‡¶ï‡ßá ‡¶®‡¶ø‡¶§‡ßá ‡¶π‡¶¨‡ßá
                let phone = localStorage.getItem('uPhone') || 'Guest';
                let name = localStorage.getItem('uName') || 'User';
                let train = localStorage.getItem('uTrain') || 'None';
                
                db.ref('live_gps/' + phone).update({
                    user: name,
                    train: train,
                    lat: pos.coords.latitude,
                    lng: pos.coords.longitude,
                    time: Date.now()
                });
            }, null, { enableHighAccuracy: true });
        }
        updateAdminView();
    }

    // ‡¶∏‡ßç‡¶Æ‡¶æ‡¶∞‡ßç‡¶ü AI ‡¶∏‡¶æ‡¶∞‡ßç‡¶ö ‡¶≤‡¶ú‡¶ø‡¶ï
    function aiSearch() {
        let query = document.getElementById('train-input').value.trim().toLowerCase();
        let status = document.getElementById('ai-response');
        let map = document.getElementById('map-container');
        
        status.style.display = 'block';
        status.innerHTML = "ü§ñ AI ‡¶°‡¶ø‡¶∏‡¶ø‡¶∂‡¶® ‡¶®‡¶ø‡¶ö‡ßç‡¶õ‡ßá... ‡¶Ö‡¶®‡ßÅ‡¶ó‡ßç‡¶∞‡¶π ‡¶ï‡¶∞‡ßá ‡¶Ö‡¶™‡ßá‡¶ï‡ßç‡¶∑‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§";
        map.style.display = 'none';

        db.ref('live_gps').once('value', snapshot => {
            let activeUsers = [];
            snapshot.forEach(child => {
                let data = child.val();
                if (data.train && data.train.toLowerCase().includes(query)) {
                    activeUsers.push(data);
                }
            });

            if (activeUsers.length > 0) {
                // ‡ß®-‡ß© ‡¶ú‡¶® ‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡ßá‡¶∞ ‡¶≤‡ßã‡¶ï‡ßá‡¶∂‡¶® ‡¶´‡¶ø‡¶≤‡ßç‡¶ü‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶æ (‡¶™‡ßç‡¶∞‡¶•‡¶Æ ‡ß® ‡¶ú‡¶®‡¶ï‡ßá ‡¶®‡ßá‡¶ì‡ßü‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá)
                let topUsers = activeUsers.slice(0, 2);
                let target = topUsers[0]; // ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶™‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶™‡ßç‡¶∞‡¶ß‡¶æ‡¶® ‡¶ü‡¶æ‡¶∞‡ßç‡¶ó‡ßá‡¶ü

                status.innerHTML = `‚úÖ <b>AI ‡¶∏‡¶´‡¶≤:</b> ‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶®‡ßá ‡¶ü‡ßç‡¶∞‡ßá‡¶®‡ßá‡¶∞ ‡¶≠‡ßá‡¶§‡¶∞‡ßá ${activeUsers.length} ‡¶ú‡¶® ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶Ü‡¶õ‡ßá‡•§ ‡ß® ‡¶ú‡¶®‡ßá‡¶∞ ‡¶≤‡ßã‡¶ï‡ßá‡¶∂‡¶® ‡¶≠‡ßá‡¶∞‡¶ø‡¶´‡¶æ‡¶á ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§`;
                
                // ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™‡ßá‡¶∞ ‡¶≠‡ßá‡¶§‡¶∞‡ßá‡¶á ‡¶ó‡ßÅ‡¶ó‡¶≤ ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶™ ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®‡ßã
                map.style.display = 'block';
                map.src = `https://maps.google.com/maps?q=${target.lat},${target.lng}&z=15&output=embed`;
            } else {
                status.style.borderLeftColor = "red";
                status.innerHTML = "‚ùå <b>AI ‡¶¨‡¶æ‡¶∞‡ßç‡¶§‡¶æ:</b> ‡¶¶‡ßÅ‡¶É‡¶ñ‡¶ø‡¶§, ‡¶è‡¶á ‡¶ü‡ßç‡¶∞‡ßá‡¶®‡ßá‡¶∞ ‡¶≠‡ßá‡¶§‡¶∞ ‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶®‡ßá ‡¶ï‡ßã‡¶®‡ßã ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶®‡ßá‡¶á‡•§ ‡¶§‡¶æ‡¶á ‡¶≤‡¶æ‡¶á‡¶≠ ‡¶≤‡ßã‡¶ï‡ßá‡¶∂‡¶® ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®‡ßã ‡¶∏‡¶Æ‡ßç‡¶≠‡¶¨ ‡¶π‡¶ö‡ßç‡¶õ‡ßá ‡¶®‡¶æ‡•§";
            }
        });
    }

    // ‡¶è‡¶°‡¶Æ‡¶ø‡¶® ‡¶≠‡¶ø‡¶â ‡¶≤‡¶ú‡¶ø‡¶ï
    function updateAdminView() {
        db.ref('live_gps').on('value', s => {
            let list = document.getElementById('user-list');
            list.innerHTML = "";
            s.forEach(c => {
                let d = c.val();
                list.innerHTML += `<div class="user-dot">üìç ${d.user} - ${d.train}</div>`;
            });
        });
    }
</script>

</body>
    </html>
