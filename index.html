<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BD-IN SMART APP</title>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-database-compat.js"></script>
    <style>
        :root { --primary: #1e3c72; --bg: #f0f3f7; }
        body { font-family: 'Segoe UI', Arial, sans-serif; background: var(--bg); margin: 0; padding-bottom: 70px; }
        .top-header { background: var(--primary); color: white; padding: 15px; text-align: center; font-weight: bold; }
        .container { padding: 15px; }
        .feature-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .feature-item { background: white; border-radius: 12px; padding: 25px 10px; text-align: center; box-shadow: 0 4px 6px rgba(0,0,0,0.1); border-bottom: 4px solid var(--primary); cursor: pointer; font-weight: bold; }
        #single-view { display: none; background: white; border-radius: 15px; padding: 20px; min-height: 500px; text-align: center; position: relative; }
        .btn { width: 100%; padding: 14px; border-radius: 10px; border: none; background: var(--primary); color: white; font-weight: bold; cursor: pointer; margin-top: 10px; }
        .input-box { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #ccc; border-radius: 8px; box-sizing: border-box; }
        .ai-msg { background: #e3f2fd; padding: 12px; border-radius: 10px; margin-top: 10px; border-left: 5px solid #2196f3; text-align: left; font-size: 13px; }
        iframe { width: 100%; height: 350px; border-radius: 10px; margin-top: 15px; display: none; border: 2px solid var(--primary); }
        
        /* ‡¶ö‡ßç‡¶Ø‡¶æ‡¶ü ‡¶¨‡¶æ‡¶¨‡¶≤ ‡¶°‡¶ø‡¶ú‡¶æ‡¶á‡¶® */
        #chat-display { height: 300px; overflow-y: auto; background: #fff; border: 1px solid #ddd; border-radius: 12px; padding: 12px; margin-bottom: 10px; display: flex; flex-direction: column; gap: 10px; }
        .msg-user { align-self: flex-end; background: #1e3c72; color: white; padding: 8px 12px; border-radius: 15px 15px 0px 15px; max-width: 85%; font-size: 14px; text-align: left; }
        .msg-ai { align-self: flex-start; background: #f1f1f1; color: #333; padding: 8px 12px; border-radius: 15px 15px 15px 0px; max-width: 85%; font-size: 14px; text-align: left; line-height: 1.5; }
    </style>
</head>
<body onload="renderGrid();">

    <div class="top-header">BD-IN SMART APP</div>

    <div class="container">
        <div class="feature-grid" id="feature-grid"></div>
        <div id="single-view">
            <button onclick="goBack()" style="float:left; padding: 8px 15px; border-radius: 6px; background: #333; color: white; border: none;">‚Üê ‡¶´‡¶ø‡¶∞‡ßá ‡¶Ø‡¶æ‡¶®</button>
            <div style="clear:both; padding-top:10px;"></div>
            <h2 id="view-title" style="font-size: 18px;"></h2>
            <div id="view-content"></div>
        </div>
    </div>

    <script>
        // ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡ß™‡¶ü‡¶ø ‡¶è‡¶Ü‡¶á ‡¶ï‡ßÄ ‡¶è‡¶¨‡¶Ç ‡¶´‡¶æ‡ßü‡¶æ‡¶∞‡¶¨‡ßá‡¶∏ ‡¶ï‡¶®‡¶´‡¶ø‡¶ó
        const keys = [
            { type: 'gemini', val: "AIzaSyBSKhDI7bTVOWyiJAJcJESD7B34jZzYwII" },
            { type: 'gemini', val: "AIzaSyDNYwHjqE01Oxez6PA0OevDlQtdeuIliLk" },
            { type: 'groq', val: "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" },
            { type: 'groq', val: "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" }
        ];
        let currentKeyIdx = 0;

        const firebaseConfig = {
            apiKey: keys[0].val,
            databaseURL: "https://bd--in-smart-app-default-rtdb.firebaseio.com/",
            projectId: "bd--in-smart-app"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        const features = [
            { id: 1, name: "‡¶ü‡ßç‡¶∞‡ßá‡¶® ‡¶≤‡ßã‡¶ï‡ßá‡¶∂‡¶®", icon: "üöÇ" },
            { id: 2, name: "‡¶ú‡¶ø‡¶™‡¶ø‡¶è‡¶∏ ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶™", icon: "üó∫Ô∏è" },
            { id: 3, name: "AI ‡¶Ö‡¶®‡ßÅ‡¶¨‡¶æ‡¶¶‡¶ï ‡¶ì ‡¶ö‡ßç‡¶Ø‡¶æ‡¶ü", icon: "ü§ñ" }
        ];

        function renderGrid() {
            const grid = document.getElementById('feature-grid');
            grid.innerHTML = features.map(f => `<div class="feature-item" onclick="openFeature(${f.id})"><div>${f.icon}</div>${f.name}</div>`).join('');
        }

        function openFeature(id) {
            document.getElementById('feature-grid').style.display = 'none';
            document.getElementById('single-view').style.display = 'block';
            const content = document.getElementById('view-content');
            const title = document.getElementById('view-title');
            const f = features.find(i => i.id === id);
            title.innerText = f.icon + " " + f.name;

            if(id === 1) {
                content.innerHTML = `
                    <input id="t-input" class="input-box" placeholder="‡¶ü‡ßç‡¶∞‡ßá‡¶®‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®...">
                    <button class="btn" onclick="searchLoc('train')">‡¶≤‡ßã‡¶ï‡ßá‡¶∂‡¶® ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®</button>
                    <div id="res"></div><iframe id="map"></iframe>`;
            } else if(id === 2) {
                content.innerHTML = `
                    <input id="u-input" class="input-box" placeholder="‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶Ü‡¶á‡¶°‡¶ø ‡¶¨‡¶æ ‡¶®‡¶æ‡¶Æ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®...">
                    <button class="btn" onclick="searchLoc('user')">‡¶ú‡¶ø‡¶™‡¶ø‡¶è‡¶∏ ‡¶ü‡ßç‡¶∞‡ßç‡¶Ø‡¶æ‡¶ï‡¶ø‡¶Ç</button>
                    <div id="res"></div><iframe id="map"></iframe>`;
            } else if(id === 3) {
                content.innerHTML = `
                    <div id="chat-display"><div class="msg-ai">‡¶Ü‡¶∏‡¶∏‡¶æ‡¶≤‡¶æ‡¶Æ‡ßÅ ‡¶Ü‡¶≤‡¶æ‡¶á‡¶ï‡ßÅ‡¶Æ! ‡¶Ü‡¶Æ‡¶ø ‡¶ï‡ßÄ‡¶≠‡¶æ‡¶¨‡ßá ‡¶∏‡¶æ‡¶π‡¶æ‡¶Ø‡ßç‡¶Ø ‡¶ï‡¶∞‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡¶ø?</div></div>
                    <div style="display:flex; gap:5px;">
                        <textarea id="ai-input" class="input-box" rows="1" style="margin:0; border-radius:20px;" placeholder="‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®..."></textarea>
                        <button onclick="askAI('chat')" style="background:#1e3c72; color:white; border:none; width:45px; border-radius:50%; font-size:20px;">‚ûî</button>
                    </div>
                    <button onclick="askAI('translate')" style="background:none; border:1px solid green; color:green; margin-top:8px; border-radius:10px; padding:5px; font-size:12px;">üåê ‡¶¶‡ßç‡¶∞‡ßÅ‡¶§ ‡¶Ö‡¶®‡ßÅ‡¶¨‡¶æ‡¶¶</button>
                    <div style="height:50px; margin-top:10px; background:#eee; display:flex; align-items:center; justify-content:center; font-size:10px;">‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶® (Banner Ad)</div>`;
            }
        }

        async function searchLoc(type) {
            const val = document.getElementById(type === 'train' ? 't-input' : 'u-input').value.trim().toLowerCase();
            const res = document.getElementById('res');
            const map = document.getElementById('map');
            if(!val) return;
            res.innerHTML = "ü§ñ AI ‡¶ñ‡ßÅ‡¶Å‡¶ú‡¶õ‡ßá...";
            db.ref('live_gps').once('value', s => {
                let f = null;
                s.forEach(c => {
                    let d = c.val();
                    let t = type === 'train' ? (d.train || "") : (d.name || c.key);
                    if(t.toLowerCase().includes(val)) f = d;
                });
                if(f) {
                    res.innerHTML = "‚úÖ ‡¶≤‡ßã‡¶ï‡ßá‡¶∂‡¶® ‡¶™‡¶æ‡¶ì‡ßü‡¶æ ‡¶ó‡ßá‡¶õ‡ßá!";
                    map.style.display = "block";
                    map.src = `https://www.openstreetmap.org/export/embed.html?bbox=${f.lng-0.005},${f.lat-0.005},${f.lng+0.005},${f.lat+0.005}&layer=mapnik&marker=${f.lat},${f.lng}`;
                } else { res.innerHTML = "‚ùå ‡¶™‡¶æ‡¶ì‡ßü‡¶æ ‡¶Ø‡¶æ‡ßü‡¶®‡¶ø!"; }
            });
        }

        async function askAI(mode) {
            const input = document.getElementById('ai-input');
            const display = document.getElementById('chat-display');
            const text = input.value.trim();
            if(!text) return;
            display.innerHTML += `<div class="msg-user">${text}</div>`;
            input.value = "";
            display.scrollTop = display.scrollHeight;
            let prompt = mode === 'translate' ? `Translate to Bengali and English: "${text}"` : text;
            const loading = document.createElement("div");
            loading.className = "msg-ai"; loading.innerText = "‡¶ü‡¶æ‡¶á‡¶™ ‡¶ï‡¶∞‡¶õ‡¶ø...";
            display.appendChild(loading);
            try {
                const response = await callAI(prompt);
                loading.innerText = response;
                display.scrollTop = display.scrollHeight;
            } catch (e) {
                currentKeyIdx = (currentKeyIdx + 1) % keys.length;
                askAI(mode);
            }
        }

        async function callAI(p) {
            const k = keys[currentKeyIdx];
            if(k.type === 'gemini') {
                const r = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${k.val}`, {
                    method: "POST", headers: {"Content-Type": "application/json"},
                    body: JSON.stringify({contents: [{parts: [{text: p}]}]})
                });
                const d = await r.json(); return d.candidates[0].content.parts[0].text;
            } else {
                const r = await fetch("https://api.groq.com/openai/v1/chat/completions", {
                    method: "POST", headers: {"Authorization": `Bearer ${k.val}`, "Content-Type": "application/json"},
                    body: JSON.stringify({model: "llama3-8b-8192", messages: [{role: "user", content: p}]})
                });
                const d = await r.json(); return d.choices[0].message.content;
            }
        }

        function goBack() {
            document.getElementById('feature-grid').style.display = 'grid';
            document.getElementById('single-view').style.display = 'none';
        }
    </script>
</body>
    </html>
