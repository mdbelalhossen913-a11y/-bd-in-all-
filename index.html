<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BD-IN SMART APP</title>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-database-compat.js"></script>
    <style>
        :root { --primary: #1e3c72; --bg: #f0f3f7; }
        body { font-family: 'Segoe UI', Arial, sans-serif; background: var(--bg); margin: 0; padding-bottom: 70px; }
        .top-header { background: var(--primary); color: white; padding: 15px; text-align: center; font-weight: bold; }
        .container { padding: 15px; }
        .feature-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .feature-item { background: white; border-radius: 12px; padding: 20px 10px; text-align: center; box-shadow: 0 4px 6px rgba(0,0,0,0.1); border-bottom: 4px solid var(--primary); cursor: pointer; }
        .feature-item span { font-size: 35px; display: block; margin-bottom: 8px; }
        #single-view { display: none; background: white; border-radius: 15px; padding: 20px; min-height: 480px; text-align: center; }
        .btn { width: 100%; padding: 14px; border-radius: 10px; border: none; background: var(--primary); color: white; font-weight: bold; cursor: pointer; margin-top: 10px; }
        .input-box { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #ccc; border-radius: 8px; box-sizing: border-box; }
        .ai-msg { background: #e3f2fd; padding: 15px; border-radius: 10px; margin-top: 10px; border-left: 5px solid #2196f3; text-align: left; font-size: 14px; }
        #map-f { width:100%; height:320px; border-radius:10px; margin-top:15px; display:none; border:1px solid #ddd; }
        #ad-box { position: fixed; bottom: 0; left: 0; width: 100%; height: 55px; background: white; border-top: 1px solid #ddd; display: flex; align-items: center; justify-content: center; z-index: 1000; }
    </style>
</head>
<body onload="renderGrid();">

    <div class="top-header">BD-IN SMART APP | AI GLOBAL CONTROL</div>

    <div class="container">
        <div class="feature-grid" id="feature-grid"></div>

        <div id="single-view">
            <button onclick="goBack()" style="float:left; padding: 8px 15px; border-radius: 6px; background: #333; color: white; border: none;">‚Üê ‡¶´‡¶ø‡¶∞‡ßá ‡¶Ø‡¶æ‡¶®</button>
            <div style="clear:both; padding-top:15px;"></div>
            <h2 id="view-title" style="color:var(--primary)"></h2>
            <div id="view-content"></div>
        </div>
    </div>

    <div id="ad-box"><small>‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶® ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</small></div>

    <script>
        // AI Keys (‡ßß‡¶ü‡¶ø ‡¶∂‡ßá‡¶∑ ‡¶π‡¶≤‡ßá ‡¶Ö‡¶®‡ßç‡¶Ø‡¶ü‡¶ø ‡¶ï‡¶æ‡¶ú ‡¶ï‡¶∞‡¶¨‡ßá)
        const geminiKeys = ["AIzaSyBSKhDI7bTVOWyiJAJcJESD7B34jZzYwII", "AIzaSyDNYwHjqE01Oxez6PA0OevDlQtdeuIliLk"];
        let currentKey = geminiKeys[0];

        const firebaseConfig = {
            apiKey: currentKey,
            databaseURL: "https://bd--in-smart-app-default-rtdb.firebaseio.com/",
            projectId: "bd--in-smart-app"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        const features = [
            { id: 1, name: "‡¶ü‡ßç‡¶∞‡ßá‡¶® ‡¶≤‡ßã‡¶ï‡ßá‡¶∂‡¶®", icon: "üöÇ" }, { id: 2, name: "‡¶ú‡¶ø‡¶™‡¶ø‡¶è‡¶∏ ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶™", icon: "üó∫Ô∏è" },
            { id: 3, name: "‡¶°‡¶ø‡¶ú‡¶ø‡¶ü‡¶æ‡¶≤ ‡¶∏‡ßá‡¶≤", icon: "üìà" }, { id: 4, name: "AI ‡¶Ö‡¶®‡ßÅ‡¶¨‡¶æ‡¶¶‡¶ï", icon: "üåê" },
            { id: 5, name: "‡¶®‡¶ø‡¶â‡¶ú ‡¶™‡ßã‡¶∞‡ßç‡¶ü‡¶æ‡¶≤", icon: "üì∞" }, { id: 6, name: "‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏", icon: "‚öôÔ∏è" },
            { id: 7, name: "‡¶á‡¶∏‡¶≤‡¶æ‡¶Æ‡¶ø‡¶ï", icon: "üïå" }, { id: 8, name: "‡¶Æ‡ßá‡¶∏‡ßá‡¶û‡ßç‡¶ú‡¶æ‡¶∞ AI", icon: "üí¨" },
            { id: 9, name: "‡¶ò‡ßã‡¶∑‡¶£‡¶æ", icon: "üì¢" }, { id: 10, name: "‡¶≠‡ßá‡¶∞‡¶ø‡¶´‡¶æ‡¶á", icon: "‚úÖ" },
            { id: 11, name: "‡¶ú‡¶∞‡ßÅ‡¶∞‡¶ø ‡¶∏‡ßá‡¶¨‡¶æ", icon: "üö®" }, { id: 12, name: "‡¶∏‡¶æ‡¶™‡ßã‡¶∞‡ßç‡¶ü", icon: "üì±" },
            { id: 13, name: "‡¶ü‡¶ø‡¶ï‡ßá‡¶ü ‡¶¨‡ßÅ‡¶ï‡¶ø‡¶Ç", icon: "üéüÔ∏è" }
        ];

        function renderGrid() {
            const grid = document.getElementById('feature-grid');
            grid.innerHTML = features.map(f => `<div class="feature-item" onclick="openFeature(${f.id})"><span>${f.icon}</span><b>${f.name}</b></div>`).join('');
        }

        function openFeature(id) {
            // Reward Ad Trigger: ca-app-pub-6144850890538766/3544142618
            document.getElementById('feature-grid').style.display = 'none';
            document.getElementById('single-view').style.display = 'block';
            const f = features.find(i => i.id === id);
            document.getElementById('view-title').innerText = f.icon + " " + f.name;

            if(id === 1) {
                document.getElementById('view-content').innerHTML = `
                    <div class="ai-msg">ü§ñ <b>‡¶ó‡ßç‡¶≤‡ßã‡¶¨‡¶æ‡¶≤ AI ‡¶∏‡¶æ‡¶∞‡ßç‡¶ö:</b> ‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ‡¶¶‡ßá‡¶∂ ‡¶¨‡¶æ ‡¶≠‡¶æ‡¶∞‡¶§‡ßá‡¶∞ ‡¶Ø‡ßá‡¶ï‡ßã‡¶®‡ßã ‡¶ü‡ßç‡¶∞‡ßá‡¶®‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ‡ßá‡¶∞ ‡¶™‡ßç‡¶∞‡¶•‡¶Æ ‡¶ï‡ßü‡ßá‡¶ï ‡¶Ö‡¶ï‡ßç‡¶∑‡¶∞ ‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ ‡¶¨‡¶æ ‡¶á‡¶Ç‡¶∞‡ßá‡¶ú‡¶ø‡¶§‡ßá ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®‡•§</div>
                    <input id="t-input" class="input-box" placeholder="‡¶Ø‡ßá‡¶Æ‡¶®: ‡¶∏‡ßÅ‡¶¨‡¶∞‡ßç‡¶£ ‡¶¨‡¶æ Benapole">
                    <button class="btn" onclick="aiSearchTrain()">‡¶≤‡¶æ‡¶á‡¶≠ ‡¶ü‡ßç‡¶∞‡ßç‡¶Ø‡¶æ‡¶ï‡¶ø‡¶Ç ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                    <div id="ai-status"></div>
                    <iframe id="map-f" frameborder="0"></iframe>
                `;
            } else {
                document.getElementById('view-content').innerHTML = `<div class="ai-msg">‡¶è‡¶á ‡¶¨‡¶æ‡¶ü‡¶®‡¶ü‡¶ø (${f.name}) ‡¶è‡¶ï‡¶ü‡ßÅ ‡¶™‡¶∞ ‡¶∏‡¶æ‡¶ú‡¶æ‡¶¨‡ßã‡•§</div>`;
            }
        }

        function aiSearchTrain() {
            const search = document.getElementById('t-input').value.trim().toLowerCase();
            const status = document.getElementById('ai-status');
            const map = document.getElementById('map-f');
            if(!search) return alert("‡¶ü‡ßç‡¶∞‡ßá‡¶®‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ ‡¶¶‡¶ø‡¶®");

            status.innerHTML = `<div class="ai-msg">ü§ñ AI ‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ‡¶¶‡ßá‡¶∂ ‡¶ì ‡¶≠‡¶æ‡¶∞‡¶§‡ßá‡¶∞ ‡¶°‡¶æ‡¶ü‡¶æ‡¶¨‡ßá‡¶∏ ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡¶õ‡ßá...</div>`;
            map.style.display = "none";

            db.ref('live_gps').once('value', snapshot => {
                let found = [];
                snapshot.forEach(child => {
                    let d = child.val();
                    let trainName = d.train ? d.train.toLowerCase() : "";
                    // ‡¶®‡¶æ‡¶Æ‡ßá‡¶∞ ‡¶Ø‡ßá‡¶ï‡ßã‡¶®‡ßã ‡¶Ö‡¶Ç‡¶∂‡ßá ‡¶Æ‡¶ø‡¶≤ ‡¶•‡¶æ‡¶ï‡¶≤‡ßá ‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßá ‡¶™‡¶æ‡¶¨‡ßá
                    if (trainName.includes(search)) found.push(d);
                });

                if (found.length > 0) {
                    let u = found[0];
                    status.innerHTML = `<div class="ai-msg" style="border-left-color:green">‚úÖ <b>AI ‡¶∞‡ßá‡¶ú‡¶æ‡¶≤‡ßç‡¶ü:</b> ‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶®‡ßá ‡¶è‡¶á ‡¶ü‡ßç‡¶∞‡ßá‡¶®‡ßá‡¶∞ ‡¶≠‡ßá‡¶§‡¶∞‡ßá ${found.length} ‡¶ú‡¶® ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶Ü‡¶õ‡ßá‡¶®‡•§ ‡¶≤‡¶æ‡¶á‡¶≠ ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶™ ‡¶®‡¶ø‡¶ö‡ßá ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®‡•§</div>`;
                    map.style.display = "block";
                    map.src = `https://www.google.com/maps?q=${u.lat},${u.lng}&t=k&z=15&output=embed`;
                } else {
                    status.innerHTML = `<div class="ai-msg" style="border-left-color:red">‚ùå <b>AI ‡¶∞‡ßá‡¶ú‡¶æ‡¶≤‡ßç‡¶ü:</b> ‡¶¶‡ßÅ‡¶É‡¶ñ‡¶ø‡¶§, ‡¶è‡¶á ‡¶ü‡ßç‡¶∞‡ßá‡¶®‡ßá‡¶∞ ‡¶≠‡ßá‡¶§‡¶∞‡ßá ‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶®‡ßá ‡¶Ü‡¶Æ‡¶æ‡¶¶‡ßá‡¶∞ ‡¶ï‡ßã‡¶®‡ßã ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶®‡ßá‡¶á‡•§</div>`;
                }
            }).catch(() => {
                // ‡¶ö‡¶æ‡¶¨‡¶ø ‡¶∂‡ßá‡¶∑ ‡¶π‡¶≤‡ßá ‡¶Ö‡¶ü‡ßã ‡¶∏‡ßÅ‡¶á‡¶ö
                currentKey = geminiKeys[1];
                aiSearchTrain();
            });
        }

        function goBack() {
            document.getElementById('feature-grid').style.display = 'grid';
            document.getElementById('single-view').style.display = 'none';
        }
    </script>
</body>
</html>
